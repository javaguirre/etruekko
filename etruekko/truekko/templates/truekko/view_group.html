{% extends "base.html" %}
{% load i18n %}
{% block title %}
    {% blocktrans with viewing.name as name %} Group / {{ name }} {% endblocktrans %}
{% endblock %}

{% block content %}
    <h2>
        <div class="left"><img src="{% groupavatar viewing 32 %}" alt="{{ viewing.name }}"/></div>
        {% blocktrans with viewing.name as name %} Group / {{ name }} {% endblocktrans %}
        <div class="clear"></div>
    </h2>

    <div id="subcontent">
        <div class="buttons">
            {% if editable %}
                <a class="button" href="{% url edit_group viewing.name %}">{% trans "Edit" %}</a>
                <a class="button" href="{% url edit_group_members viewing.name %}">{% trans "Edit members" %}</a>
            {% endif %}
            {% if member %}
                <form method="POST" action="{% url leave_group viewing.name %}"> {% csrf_token %}
                    <input class="link" type="submit" value="Leave"/>
                </form>
            {% else %}
                <form method="POST" action="{% url join_group viewing.name %}"> {% csrf_token %}
                    <input class="link" type="submit" value="Join"/>
                </form>
            {% endif %}
        </div>

        <div id="profile">
            <div id="profileimg">
                <img src="{% groupavatar viewing 128 %}" alt="{{ viewing.name }}"/>
                <div id="thumbtack"></div>
            </div>
            <span class="location"><a href="{% url groups %}?search={{ viewing.location }}">{{ viewing.location }}</a></span>
            <span class="username">{{ viewing.name }}</span>
            <a href="{{ viewing.web }}" class="web">{{ viewing.web }}</a>
            <p class="description">{{ viewing.description }}</p>
        </div>
        <div class="clear"></div>

        <h3>
            {% trans "Members" %}
            {% if editable and requests %}
                (<a href="{% url edit_group_members viewing.name %}">{{ requests }} {% trans "pending requests" %}</a>)
            {% endif %}
        </h3>
        {% for membership in memberships %}
            {% with user=membership.user %}
            <!-- TODO use a template for this -->
            <div class="user">
                <a href="{% url view_profile user.username %}"><img src="{% avatar user 64 %}" alt="{{ user.username }}"/></a>
                <a href="{% url view_profile user.username %}"><span class="username">{{ user.username }}</span></a>
                <span class="fullname">{{ user.get_profile.name }}</span>
                <span class="location"><a href="{% url people %}?search={{ user.get_profile.location }}">{{ user.get_profile.location }}</a></span>
                <p class="description">{{ user.get_profile.description|truncatewords:20 }}</p>
                <span class="date">
                    {% blocktrans with user.date_joined|timesince as d %}
                        user since {{ d }}
                    {% endblocktrans %}
                </span>
                <div class="clear"></div>
            </div>
            <!-- -->
            {% endwith %}
        {% endfor %}
    </div>
{% endblock %}
